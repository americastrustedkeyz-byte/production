<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- 1. Define the Template FIRST -->
    <template id="custom_user_page_template" name="Custom User Template">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <section class="s_title pt32 pb32 bg-200">
                    <div class="container text-center">
                        <h1>Visibility Test Page</h1>
                        <p>2026 Theme Deployment - Odoo.sh</p>
                    </div>
                </section>

                <t t-if="not user_id.id == website.user_id.id">
                    <section class="s_text_block pt64 pb64" style="background-color: #d4edda;">
                        <div class="container text-center">
                            <h2 class="text-success">Welcome Back, <t t-esc="user_id.name"/>!</h2>
                        </div>
                    </section>
                </t>

                <t t-if="user_id.id == website.user_id.id">
                    <section class="s_text_block pt64 pb64" style="background-color: #fff3cd;">
                        <div class="container text-center">
                            <h2 class="text-warning">Public Access Only</h2>
                        </div>
                    </section>
                </t>
                <div class="oe_structure"/>
            </div>
        </t>
    </template>

    <!-- 2. Define the Page Record SECOND (Now it can find the template above) -->
    <record id="custom_user_page_record" model="website.page">
        <field name="name">Custom User Visibility</field>
        <field name="url">/custom_user_page</field>
        <field name="type">qweb</field>
        <field name="view_id" ref="custom_user_page_template"/>
        <field name="is_published">True</field>
    </record>

    <!-- 3. Optional: Menu Item -->
    <record id="menu_custom_user" model="website.menu">
        <field name="name">Custom Visibility</field>
        <field name="url">/custom_user_page</field>
        <field name="parent_id" ref="website.main_menu"/>
        <field name="sequence" type="int">50</field>
    </record>
</odoo>
